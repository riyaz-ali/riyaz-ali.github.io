<!doctype html><html lang=en><head><title>The less trodden path with sqlite :: Riyaz Ali</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="Lately, I&amp;rsquo;ve been tinkering around a bit with sqlite3, and this post contains a brief of some exciting set of features and interfaces that I&amp;rsquo;ve re-discovered during the process.
 sqlite3 isn&amp;rsquo;t exactly new. It&amp;rsquo;s been around for almost two decades now (much longer than I&amp;rsquo;ve known coding myself ðŸ˜›). There&amp;rsquo;s plethora of articles on the internet describing what it is, what makes it special, when you should ideally use it (and when not) and why &amp;ldquo;it&amp;rsquo;s the only database you will ever need&amp;rdquo;."><meta name=keywords content="Software Engineering,SQLite"><meta name=robots content="noodp"><link rel=canonical href=https://riyazali.net/posts/the-less-trodden-path-with-sqlite/><link rel=stylesheet href=https://riyazali.net/assets/style.css><link rel=stylesheet href=https://riyazali.net/assets/blue.css><link rel=stylesheet href=https://riyazali.net/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://riyazali.net/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://riyazali.net/icons/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:creator content="riyaz-ali"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="The less trodden path with sqlite :: Riyaz Ali"><meta property="og:description" content="In this article, I highlight exciting set of features and interfaces 
that allows you to unlock the full potential of sqlite3
"><meta property="og:url" content="https://riyazali.net/posts/the-less-trodden-path-with-sqlite/"><meta property="og:site_name" content="The less trodden path with sqlite"><meta property="og:image" content="https://riyazali.net/icons/favicon.ico"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2021-03-27 02:00:00 +0000 UTC"><script data-goatcounter=https://goat.riyazali.net/count async src=https://goat.riyazali.net/count.js></script></head><body><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Riyaz Ali</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/resume.pdf>Resume</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/resume.pdf>Resume</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://riyazali.net/posts/the-less-trodden-path-with-sqlite/>The less trodden path with sqlite</a></h1><div class=post-meta><span class=post-date>2021-03-27</span>
<span class=post-author>::
riyaz-ali</span></div><span class=post-tags>#<a href=https://riyazali.net/tags/software-engineering/>Software Engineering</a>&nbsp;
#<a href=https://riyazali.net/tags/sqlite/>SQLite</a>&nbsp;</span><div class=post-content><div><p>Lately, I&rsquo;ve been tinkering around a bit with <code>sqlite3</code>, and this post contains a brief of some exciting set of features and interfaces that I&rsquo;ve re-discovered during the process.</p><hr><p><code>sqlite3</code> isn&rsquo;t exactly new. It&rsquo;s been around for almost two decades now (much longer than I&rsquo;ve known coding myself ðŸ˜›). There&rsquo;s plethora of articles on the internet describing <a href=https://www.sqlite.org/about.html>what it is</a>, what makes it special, <a href=https://www.sqlite.org/whentouse.html>when you should ideally use it</a> (and when not) and why <em><a href=https://unixsheikh.com/articles/sqlite-the-only-database-you-will-ever-need-in-most-cases.html>&ldquo;it&rsquo;s the only database you will ever need&rdquo;</a>.</em></p><p>So, I&rsquo;m not gonna repeat all those advices here. Instead I&rsquo;ll try to cover some of other exciting, specialised interfaces that <code>sqlite3</code> offers and how we can profit from it!</p><hr><h3 id=1-custom-functions-in-sql>#1 Custom functions in SQL<a href=#1-custom-functions-in-sql class=hanchor arialabel=Anchor>&#8983;</a></h3><p><code>sqlite3</code> provides support for registering <a href=https://www.sqlite.org/appfunc.html>custom, application-defined functions</a> in C that can be exposed to queries in SQL.</p><p>Custom functions can be used to integrate your queries with the rest of the system, or provide access to external functionality. They can be used to perform complex calculation or do statistical operations on data.</p><p>Custom functions can be used to marshal / un-marshal and / or manipulate data in alternative formats (such as <code>json</code>). They can be used to compute hashes and do much more!</p><p><code>sqlite3</code> comes with a bunch of built-in <a href=https://www.sqlite.org/lang_corefunc.html>scalar</a> and <a href=https://www.sqlite.org/lang_aggfunc.html>aggregate</a> functions, and with <a href=https://www.sqlite.org/lang_datefunc.html>routines to manipulate date / time information</a>. There is also <a href=https://github.com/nalgeon/sqlean>nalgeon/sqlean</a> on Github that aims to pack a lot more set of functions into convenient extensions that can be loaded on-demand.</p><h3 id=2-virtual-tables>#2 Virtual Tables<a href=#2-virtual-tables class=hanchor arialabel=Anchor>&#8983;</a></h3><p><a href=http://sqlite.org/vtab.html>Virtual Tables</a> are one of the most exciting features of <code>sqlite3</code> that I found! Essentially, virtual table allows us to register objects with <code>sqlite3</code> that, from the perspective of an SQL statement, looks like any other table / view.</p><p>This allows the user to be able to query them just as they would do with any other table / view. When a user executes a query against a virtual table <code>sqlite3</code> invokes callback methods on the virtual table object.</p><p>This has the potential to unlock a ton of different use-cases. For eg., there&rsquo;s an <a href=https://www.sqlite.org/csv.html>official</a> <a href=https://www.sqlite.org/csv.html><code>csv</code></a> <a href=https://www.sqlite.org/csv.html>virtual table implementation</a> that allow users to query data from a <code>csv</code> file just as they would with a normal table. There are other implementations that make it possible to interface with other systems, such as <a href=https://github.com/augmentable-dev/askgit>augmentable-dev/askgit</a> uses <code>sqlite3</code> virtual tables to allow users to query data from <code>git</code> repositories, <a href=https://osquery.io>osquery.io</a> that allow users to run queries against the operating systems!</p><h3 id=3-authorizer-to-check--limit-what-a-user-can-query>#3 Authorizer to check / limit what a user can query<a href=#3-authorizer-to-check--limit-what-a-user-can-query class=hanchor arialabel=Anchor>&#8983;</a></h3><p><code>sqlite3</code> supports registering <a href=https://www.sqlite.org/c3ref/set_authorizer.html>a custom authorizer function</a> that can limit what data a query can access and what action can it perform. This, together with <a href=https://www.sqlite.org/security.html>other defensive settings</a>, can be used to turn <code>sqlite3</code> into a sandbox where we can execute raw, user-supplied, untrusted statements <em>with confidence</em> that it won&rsquo;t cause any un-intended <em>side-effects.</em></p><h3 id=4-capture-a-change-set-of-differences-in-a-session>#4 Capture a change-set of differences in a session<a href=#4-capture-a-change-set-of-differences-in-a-session class=hanchor arialabel=Anchor>&#8983;</a></h3><p><a href=https://www.sqlite.org/sessionintro.html><code>sqlite3</code> session extension</a> provides a mechanism for recording changes to some or all of the <em>rowid tables</em> in an SQLite database, and packaging those changes into a &ldquo;changeset&rdquo; file that can later be used to apply the same set of changes to another database. This can be used to capture <em>diffs</em> generated by multiple users, working asynchronously, capturing and merging it together into a unified database file.</p><p>Sessions can be useful when <code>sqlite3</code> is used as an <em>application data format</em> __ and multiple users work on the same file at the same time. Each user can generate a patch for their side of work (much like how one would do it with a vcs like <code>git</code>) and the system could combine those into a unified database file.</p><h3 id=5-online-backup-api>#5 Online Backup API<a href=#5-online-backup-api class=hanchor arialabel=Anchor>&#8983;</a></h3><p><a href=https://www.sqlite.org/backup.html><code>sqlite3</code>Online Backup API</a> allows the contents of one database to be copied into another database, in an incremental fashion where the database is only locked for the brief periods of time when it is actually being read from. This allows other database users to continue uninterrupted while a backup of an online database is made.</p><p>It provides a basic building block onto which other, more complex replication solutions can be built.</p><h3 id=6-dynamically-loaded-extensions>#6 Dynamically loaded extensions<a href=#6-dynamically-loaded-extensions class=hanchor arialabel=Anchor>&#8983;</a></h3><p><code>sqlite3</code> has <a href=https://www.sqlite.org/loadext.html>support for building extensions</a> that can either be loaded dynamically (as a shared object file) or linked statically into the final build.</p><p>The <a href="https://sqlite.org/src/file?name=src/sqlite3ext.h&ci=trunk"><code>sqlite3ext.h</code></a> defines the Extension API which the module can use to interact with the database connection (that loaded the extension). The extension can do pretty much anything that you could normally do with the <code>sqlite3</code> core, like registering custom functions, defining virtual table modules and more!</p><p>One should consider building re-usable modules as loadable extensions to allow for easier distribution and better re-use.</p><hr><p>In the follow-up articles, I would try to cover some of the features I&rsquo;ve discussed here and how one can leverage those while coding with Golang using <a href=http://go.riyazali.net/sqlite>http://go.riyazali.net/sqlite</a>, a library that I recently open-sourced ðŸ¤—</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://riyazali.net/posts/berkeley-packet-filter-in-golang/><span class=button__text>Berkeley Packet Filter in Golang</span>
<span class=button__icon>â†’</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>Â© Riyaz Ali</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://riyazali.net/assets/main.js></script><script src=https://riyazali.net/assets/prism.js></script><div class=license><div>Unless stated, contents of this site are licensed under <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>CreativeCommons BY-SA 4.0</a></div><div>Source snippets licensed under <a rel=license href=https://opensource.org/licenses/MIT>MIT Â© Riyaz Ali 2024</a></div><div style=margin-top:16px><a href=https://twitter.com/riyaz2302 style=text-decoration:none><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" style="fill:#fff" viewBox="0 0 24 24"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179.0-5.515 2.966-4.797 6.045C7.728 8.088 4.1 6.128 1.671 3.149c-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142.0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/></svg></a><span style=padding-left:8px></span><a href=https://github.com/riyaz-ali style=text-decoration:none><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" style="fill:#fff"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg></a></div></div></div></body></html>